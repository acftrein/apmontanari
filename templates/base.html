<!DOCTYPE html>
<html lang="pt">

<head>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="theme-color" content="#2185d0" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App Montanari</title>

  <!-- CSS Semantic UI -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.css" />

  <!-- jQuery (precisa vir antes do Semantic JS) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- JavaScript Semantic UI -->
  <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.5.0/dist/semantic.min.js"></script>

  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .ui.container {
      max-width: 100%;
      padding: 1em;
    }

    .ui.form input {
      width: 100%;
    }

    .ui.items .item {
      border: 1px solid #eee;
      border-radius: 4px;
      margin-bottom: 0.5em;
    }

    .ui.divided.items>.item:first-child {
      border-top: 1px solid #d4d4d5 !important;
    }
  </style>

  <style>
    /* Garantir rolagem interna no modal em dispositivos móveis */
    #records-modal .content.scrolling {
      max-height: 70vh !important;
      overflow-y: auto !important;
      -webkit-overflow-scrolling: touch !important;
      /* suaviza o scroll no iOS */
      padding-right: 0.5em;
    }
  </style>

</head>

<body>
  <div class="ui container">
    <h2 class="ui center aligned header">Recebimentos</h2>
    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <div class="ui red message" id="flash-message">
      {% for msg in messages %}
      <p>{{ msg }}</p>
      {% endfor %}
    </div>
    {% endif %}
    {% endwith %}
    {% block fixed_content %}{% endblock %}
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const flash = document.getElementById("flash-message");
      if (flash) {
        setTimeout(() => {
          flash.style.transition = "opacity 0.5s ease-out";
          flash.style.opacity = 0;
          setTimeout(() => flash.remove(), 500);  // remove do DOM após desaparecer
        }, 3000);  // 3 segundos
      }
    });
  </script>

  <div style="flex: 1 1 auto; padding-top: 0.0em; padding-left: 1.7em; padding-right: 1.5em;">
    {% block scrollable_content %}{% endblock %}
  </div>

  <!-- Máscaras CPF e valor, exclusão de registros -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const cpfInput = document.getElementById("cpf");
      if (cpfInput) {
        cpfInput.addEventListener("input", () => {
          let v = cpfInput.value.replace(/\D/g, "").slice(0, 11);
          v = v.replace(/(\d{3})(?=\d)/g, "$1.");
          cpfInput.value = v.replace(/(\d{3})\.(\d{3})(?=\d)/, "$1.$2-");
        });
      }
      const valorInput = document.getElementById("valor");
      if (valorInput) {
        valorInput.addEventListener("input", () => {
          let v = valorInput.value.replace(/\D/g, "");
          v = (parseFloat(v) / 100).toFixed(2).toString();
          v = v.replace(".", ",").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
          valorInput.value = "R$ " + v;
        });
      }
      $(document).on('click', '#open-records', () => {
        $('#records-modal').modal('show');
      });
    });
  </script>

  <script>
    function excluirRegistro(id) {
      if (!confirm('Deseja excluir este registro?')) return;
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `/excluir/${id}`;
      document.body.appendChild(form);
      form.submit();
    }
  </script>
</body>

</html>